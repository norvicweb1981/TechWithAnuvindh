# Instructions for SDS Chatbot Deployment on AWS
ğŸ“Œ **Created by:** Amit Charan
ğŸ”§ **Modified by:** Amit Charan & Lee Yit Phang
âœ **Transcribed by:** Lee Yit Phang
ğŸ“… **Last Updated:** 2025-03-07


The following instructions are for building an SDS voice chatbot using AWS services.

![alt text](Assets/0.png)
## Prerequisites:

- A collection of SDS source files in PDF format for the chatbot to retrieve information.
- An AWS Free Tier account (with billing enabled).
- IAM user account with administrator access.

---

## IAM User Instructions

1. **Sign in** to the AWS Management Console as the root user.
2. **Search for â€˜IAMâ€™** in the AWS Management Console search bar.
3. In the IAM dashboard, click **â€˜Usersâ€™** and then **â€˜Create userâ€™**.

   ![](Assets/1.png)

**Specify user details:**
   - User name e.g., `sds-chatbot-user`.
   - Tick box for **â€˜Provide user access to the AWS Management Consoleâ€™** and select **â€˜I want to create an IAM userâ€™**.
   - Create a custom password or use an autogenerated password. Tick box for **â€˜Users must create a new password at next sign-inâ€™** for security.
   - Click **â€˜Nextâ€™**.

   ![](Assets/2.png)

4. **Set permissions:**
   - Attach policies to the IAM user. **â€˜AdministratorAccessâ€™** will give access to all necessary privileges needed to deploy the chatbot. Alternatively, the following permissions can be added to restrict full administrator access:
     - `AmazonBedrockFullAccess` â€“ grants full access to Amazon Bedrock services.
     - `AmazonS3FullAccess` â€“ grants full access to Amazon S3 buckets.
     - `AmazonOpenSearchServiceFullAccess` â€“ grants full access to Amazon OpenSearch.
     - `AmazonConnect_FullAccess` â€“ grants full access to Amazon Connect instances.
     - `AmazonLexFullAccess` â€“ grants full access to Amazon Lex bots.
     - `IAMFullAccess` â€“ grants full access to IAM services.
   - Click **â€˜Nextâ€™**.

   ![](Assets/3.png)

5. **Review permissions** and click **â€˜Create userâ€™**.

   ![](Assets/4.png)

6. **Download the CSV file.** This file contains the new user's credentials (username, password, and console sign-in URL). Store this securely.

   ![](Assets/5.png)

* **For account security, add MFA** to the IAM user. Click on the created user and select **â€˜Enable MFAâ€™**.

   ![](Assets/6.png)

* **Set up MFA.**

   ![](Assets/7.png)
   ![](Assets/8.png)

---

## **Chatbot Instructions**

### **Login**
- Use the console sign-in URL from the CSV file to log in to the AWS Management Console as the new IAM user.
- Set the AWS region to **Sydney (ap-southeast-2)** in the top right corner of the AWS Management Console.

---

## **Safety Data Sheets (SDS) in Amazon S3**

1. **Search and select â€˜S3â€™** in the console. Click **â€˜Create bucketâ€™**.

   ![](Assets/9.png)

2. **Specify bucket details:**
   - Bucket name e.g., `sds-chatbot-YOURNAME-syd`. This must be unique.
   - AWS Region: **â€˜Asia Pacific (Sydney) - ap-southeast-2â€™**.
   - Tick box for **â€˜Block Public Accessâ€™**.

   ![](Assets/10.png)

   Leave all other settings as default and click **â€˜Create bucketâ€™**.

   ![](Assets/11.png)

3. In the S3 console, click the created bucket.

   ![](Assets/12.png)

   * Click **â€˜Uploadâ€™** and then **â€˜Add filesâ€™** to select the SDS PDF files to upload.

   ![](Assets/13.png)

   * Click **â€˜Uploadâ€™**.

   ![](Assets/14.png)

---

## **Knowledge Base in Amazon Bedrock**

1. **Search and select â€˜Amazon Bedrockâ€™** in the console.
2. Click on **â€˜Model catalogâ€™** and request access for **â€˜Anthropic Claude 3â€™** and **â€˜Titan Text Embeddings V2â€™**.

   ![](Assets/15.png)

3. Click **â€˜Knowledge Basesâ€™** and then **â€˜Create Knowledge Baseâ€™**. Select **â€˜Knowledge Base with vector storeâ€™**.

   ![](Assets/16.png)
Note: Amazon OpenSearch Serverless is the vector store which deposits and retrieves vector embeddings of the text data. Embeddings is the semantic meaning of the text.  Amazon Bedrock uses these embeddings to find relevant information in the SDS files to answer user queries correctly.

4. **Specify the Knowledge Base details:**
   - Name e.g., `sds-kb-YOURNAME`.

   ![](Assets/17.png)
   Note: Do not make any changes to the service role name to prevent errors.

   * **Select â€˜Amazon S3â€™** as the data source.

   ![](Assets/18.png)

   * **Data source name:** e.g., `sds-kb-YOURNAME-ds`.
   - Browse and select the S3 URL for the S3 bucket e.g., `s3://sds-chatbot-YOURNAME-syd`.
   - Click **â€˜Nextâ€™**.

   ![](Assets/19.png)

5. Click **â€˜Select Modelâ€™** and choose **â€˜Titan Text Embeddings V2â€™**.

   ![](Assets/20.png)
   ![](Assets/21.png)

   * Click **â€˜Applyâ€™**.
6. Click **â€˜Create new vector storeâ€™** and then **â€˜Amazon OpenSearch Serverlessâ€™**. Click **â€˜Nextâ€™**.

   ![](Assets/22.png)

7.  Click **â€˜Create Knowledge Baseâ€™**. This process can take several minutes.

    ![](Assets/23.png)
Note: if the error "Access denied to aoss:CreateAccessPolicyâ€ occurs check the IAM user has â€˜AdministratorAccessâ€™ permission.
8.  **Open the created data source**, e.g., `sds-kb-YOURNAME` and click **â€˜Syncâ€™** to synchronize the knowledge base to the S3 bucket..

    ![](Assets/24.png)

---

## **Amazon Lex Chatbot**

1. **Search and select â€˜Lexâ€™** in the console. Click **â€˜Create botâ€™**.

   ![](Assets/25.png)

   * **Choose â€˜Create a blank botâ€™.**
   - Bot name: e.g., `SDS_Chatbot`
   - IAM Permissions: **â€˜Create a new role with basic Amazon Lex permissionsâ€™**.
   - COPPA: **â€˜Noâ€™**.
   - Click **â€˜Nextâ€™**.

   ![](Assets/26.png)

   * **Language:** `English`.
   - Voice iteration: e.g., `Matthew` (Note: Polly does not use this voice in the final chatbot).
   - Click **â€˜Doneâ€™**.

   ![](Assets/27.png)
---

## Intents for Conversation

### Welcome Intent

1. Go to Intents, click â€˜Add intentâ€™, then â€˜Add empty intentâ€™.

![Welcome Intent](Assets/28.png)

2. **Intent name:** `welcome_intent`.

3. **Add Sample utterances** (phrases the caller would say to initiate the conversation):

- "Hello"
- "Hi"
- "Hey there"

4. For the **initial response** (phrase the chatbot says to probe the conversation), add message:

> "Hi! Welcome to SDS Safety. How can I assist you today?"

![Initial Response](Assets/29.png)

5. Click **â€˜Advanced Optionsâ€™**, then **â€˜Next Step in conversationâ€™**, choose **â€˜Wait for users inputâ€™**. Click **â€˜update optionsâ€™**.

![Next Step](Assets/30.png)

6. Click **â€˜Save Intentâ€™**.

---

### Safety Intent

1. Click â€˜Add intentâ€™, then â€˜Use built-in intentâ€™.

![Add Intent](Assets/31.png)

2. Choose **â€˜Amazon QnAIntent (Gen AI feature)â€™**.

3. **Intent Name:** `SafetyIntent`.

4. Click â€˜Addâ€™.

![Select Model](Assets/32.png)

5. Select model **â€˜Anthropicâ€™, â€˜Claude3 Sonnetâ€™**.

6. Select **â€˜Knowledge base for Amazon Bedrockâ€™**. Copy the **Knowledge Base ID** and paste it into â€˜Knowledge base for Amazon Bedrock Idâ€™.

![Knowledge Base](Assets/33.png)

**7. Add Sample utterances:**

- "I need safety data."
- "Show me the SDS."
- "What is Seraphos 1250 used for?"
- "Who is the manufacturer of Seraphos 1250?"
- "What is the HSNO approval number for Seraphos 1250?"
- "How should I contact the supplier in case of an emergency?"
- "What hazards are associated with Seraphos 1250?"
- "What is the flash point of Seraphos 1250?"
- "What are the environmental risks of Seraphos 1250?"
- "How should Seraphos 1250 be stored safely?"
- "What are the proper precautions to take when handling Seraphos 1250?"
- "Can Seraphos 1250 be used in confined spaces or should it be used in well-ventilated areas?"
- "What should I do if I get Seraphos 1250 on my skin?"
- "What are the first-aid steps if Seraphos 1250 is inhaled?"
- "How should I treat someone who has swallowed Seraphos 1250?"
- "What type of fire extinguishing agents are recommended for Seraphos 1250?"
- "What should be avoided when fighting a fire involving Seraphos 1250?"
- "What personal protective equipment (PPE) should be worn when handling Seraphos 1250?"
- "What type of gloves are recommended when working with Seraphos 1250?"
- "Is respiratory protection required when handling Seraphos 1250?"
- "How should spills of Seraphos 1250 be cleaned up?"
- "How can I prevent Seraphos 1250 from contaminating water supplies?"
- "What environmental precautions should be taken when using Seraphos 1250?"
- "What is the acute toxicity of Seraphos 1250 if ingested?"
- "What is the environmental impact of Seraphos 1250 on aquatic life?"
- "Is Seraphos 1250 bioaccumulative?"
- "How should I dispose of Seraphos 1250 safely?"
- "Can I recycle containers that have been used for Seraphos 1250?"
- "What is the shipping classification for Seraphos 1250?"
- "What are the transport restrictions for Seraphos 1250?"

![Save Intent](Assets/34.png)

8. Click **â€˜Save Intentâ€™**.

---

### Emergency Intent (Optional)

1. Click â€˜Add intentâ€™, then â€˜Add empty intentâ€™.

2. **Intent Name:** `EmergencyIntent`

3. **Add Sample utterances:**

   - "Emergency"
   - "I have an emergency"
   - "This is an emergency"

![Emergency Intent](Assets/35.png)

4. For the **initial response** add message:

> "If this is a genuine emergency, please hang up and dial 111."

5. Click â€˜Advanced Optionsâ€™, then â€˜Next Step in conversationâ€™, choose **â€˜End conversationâ€™**. Click â€˜update optionsâ€™.

![End Conversation](Assets/36.png)

6. Click **â€˜Save Intentâ€™**.

---

### Fallback Intent

1. Click **â€˜FallbackIntentâ€™**. This is created by default but can be configured.

2. For the **initial response** add message:

> "I'm sorry, I didn't understand your request. Could you please rephrase it?"

3. Click â€˜Advanced Optionsâ€™, then â€˜Next Step in conversationâ€™, choose **â€˜Wait for users inputâ€™**. Click â€˜update optionsâ€™.

---

### Goodbye Intent

1. Click â€˜Add intentâ€™ then â€˜Add empty intentâ€™.

2. **Intent Name:** `goodbye_intent`.

3. **Add Sample utterances:**

   - "Goodbye"
   - "Thanks"
   - "See you later"

![Goodbye Intent](Assets/37.png)

4. For the **initial response** add message:

> "You're welcome! Goodbye."

5. Click â€˜Advanced Optionsâ€™, then â€˜Next Step in conversationâ€™, choose **â€˜End conversationâ€™**. Click â€˜update optionsâ€™.

![End Conversation](Assets/38.png)

6. Click **â€˜Save Intentâ€™**.

---
## Agent Referral Intent (Optional)

1. Click â€˜Add intentâ€™ then â€˜Add empty intentâ€™.

2. **Intent Name:** `agent_referral_intent`.

3. **Add Sample utterances:**

   - "I still need help"
   - "Connect me to support"
   - "Talk to a person"

![Agent Referral](Assets/39.png)

4. For the **initial response** add message:

> "I will forward your query to our customer support team. They will contact you shortly. Goodbye."

5. Click â€˜Advanced Optionsâ€™, then â€˜Next Step in conversationâ€™, choose **â€˜End conversationâ€™**. Click â€˜update optionsâ€™.

![Next Step](Assets/40.png)

6. Click **â€˜Save Intentâ€™**.

7. Click **â€˜Buildâ€™**.

8. ![Build](Assets/41.png)

Once complete, click **â€˜Testâ€™**. Enter phrases/questions in the **â€˜Test Draft versionâ€™** panel to check that the chatbot is responding correctly and providing information from the SDS files accurately. Use sample phrases/questions like:

- "What are the safety precautions for Seraphos 1240?"
- "Emergency"
- "I need to speak to someone"

9. If the chatbot provides correct responses, proceed to **AWS Connect setup**.

![AWS Connect](Assets/42.png)
![AWS Connect](Assets/43.png)
![AWS Connect](Assets/44.png)
![AWS Connect](Assets/45.png)

---

## Create Amazon Connect Instance (Phone Integration)

1. Search and select **â€˜Connectâ€™** in the console. Click **â€˜Add an instanceâ€™**.

    ![Add Instance](Assets/46.png)

2. Select **â€˜Store users in Amazon Connectâ€™** and create a custom access URL, e.g.
   `https://sds-support-YOURNAME.my.connect.aws`

    ![Custom URL](Assets/47.png)

3. **Add administrator credentials:**
   - **Username:** `admin`
   - **Password:** *(Set a secure password that will be used to log in to the connect instance.)*

   * Click **â€˜Nextâ€™**.

    ![Admin Credentials](Assets/48.png)

4. Enable **Telephony Options**. Click **â€˜Nextâ€™**.

    ![Telephony Options](Assets/49.png)
    ![Telephony Options](Assets/50.png)

5. Keep default settings and click **â€˜Create Instanceâ€™**.

**Note:** If an error occurs when creating a Connect instance, there could be a password mismatch. Delete any partial instance and then recreate the Connect instance.

6. Select the **Connect instance** e.g. `sds-support-YOURNAME`. Click on **â€˜Flowâ€™**.

   - **Region:** Asia Pacific Sydney region.
   - **Bot:** `SDS_Chatbot`.
   - **Alias:** `TestBotAlias`.

    ![Flow](Assets/51.png)

---
## Create a Contact Flow
1. In the **Connect instance overview**, click on the **Access URL** which will open the login page in a web browser. Enter the admin credentials (set previously) to log in to the Connect instance.

    ![Access URL](Assets/52.png)


2. Go to **â€˜Flowsâ€™** and click **â€˜Create flowâ€™**.

    ![Create Flow](Assets/53.png)

2. **Name:** `SDS Safety Flow`.

3. **Add a Play prompt** from the Block Library and drag it to the workspace. Click on the 3 dots to edit settings.
   - Select **â€˜Text-to-speech or chat textâ€™**.
   - Add text:
     > "Welcome to the SDS Safety Support. How can I assist you?"
   - Click **â€˜Saveâ€™**.

    ![Play Prompt](Assets/54.png)

4. **Add a Get customer input prompt** from the Block Library and drag it to the workspace. Click on the 3 dots to edit settings.
   - Select **Amazon Lex tab**.
   - **Select a Lex Bot:** `SDS_ChatBot`.
   - **Select Alias:** `TestBotAlias`.

    ![Get Customer Input](Assets/55.png)

   - Select **â€˜Text-to-speech or chat textâ€™**.
   - Add text:
     > "Please describe your safety query."
   - **Intent:** `SafetyIntent`.
   - Click **â€˜Saveâ€™**.

    ![Save Intent](Assets/56.png)

6. **Add a Disconnect prompt** from the Block Library and drag it to the workspace.
7. Ensure the prompts are linked correctly so the conversation flows.
8.  Link the **â€˜Errorsâ€™** from each prompt to the **â€˜Termination Eventâ€™**.
9.  Click **â€˜Saveâ€™** and **â€˜Publishâ€™**.

    ![Disconnect Prompt](Assets/57.png)

---

## Assign a Phone Number

1. Select **â€˜Channelsâ€™**, then **â€˜Phone Numbersâ€™**.
2. Click **â€˜Claim a Numberâ€™**.

    ![Claim a Number](Assets/58.png)

3. **Choose channel:** `Voice`
4. **Choose phone number:** `DID`, select local country (e.g., New Zealand) and pick a phone number.
5. **Choose Contact flow/IVR:** `SDS Safety Flow`.
6. Click **â€˜Saveâ€™**.

    ![Save Number](Assets/59.png)

---

## Test the Chatbot via Phone

[ICTPro Chat Bot Demo (Youtube link)](https://www.youtube.com/watch?v=It6xVcQNV9M)


1. Dial the assigned phone number.
2. Ask the chatbot sample phrases/questions like:
   - "Hi"
   - "I want to know the conditions for storing Seraphos 1250."
   - "Emergency"
   - "Talk to a person"
   - "Goodbye"

**The chatbot should:**
- Provide a greeting.
- Ask for your safety query.
- Retrieve and interpret information from the SDS PDFs to answer questions.
- Respond to emergency phrases appropriately.
- Allow the user to request a support agent.
- Say goodbye and end the call.

---

## Delete Resources to Avoid Charges

**To avoid incurring charges, follow these steps to delete all resources:**

ğŸš¨ **DO NOT delete the Amazon Connect Instance** (as it has a phone number attached which can be utilized for further testing).

### **Delete the Amazon Lex Bot:**
- Go to **Amazon Lex service**.
- Select your bot (`SDS_Chatbot`).
- Click **Delete**.

### **Delete the Amazon Bedrock Knowledge Base:**
- Go to **Amazon Bedrock service**.
- Go to **Knowledge Base**.
- Select your Knowledge Base (`sds-kb-YOURNAME`).
- Click **Delete**.

### **Delete the Amazon OpenSearch Serverless collection:**
- Go to **Amazon OpenSearch service**.
- Select **Serverless**.
- Select each resource.
- Click **Delete**.

### **Delete the S3 Bucket:**
- Go to **S3 service**.
- Select your bucket (`sds-storage-YOURNAME`).
- **Empty the bucket**.
- Click **Delete**.

ğŸ” **Double-check that all resources have been successfully deleted.**
ğŸ“Š **Monitor usage in Billing and Management the next day** to avoid unexpected charges.

---

## Considerations

- **AWS Free Tier:**
  All resources are free within limits except for OpenSearch. Be mindful of service limits and usage periods to avoid unexpected charges.

- **Resource Sizing:**
  Choose the appropriate resource size for OpenSearch to minimize costs.

- **Data Storage:**
  Use **S3 storage classes** for infrequently accessed data.

- **Tagging:**
  Add tags to each deployed resource for **identification** and **billing purposes**.

- **Phone Number Service Quota:**
  Only **5 numbers** are available on a Free Tier account. **Do not delete the Connect instance**.

---